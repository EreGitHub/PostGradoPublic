
@{
    ViewBag.Title = "Inicio";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-2">
    <h4>Módulo Inscripción<span style="font-size:12px;color:#808080"> Post-Grado</span></h4>
    <div class="card  mb-0 m-0">
        <div class="card-body">
            <div class="row">
                <div class="col-lg-8 col-md-12 col-sm-12">
                    <h4 class="form-section" style="margin-bottom:10px"><i class="fas fa-user"></i> Datos Estudiante</h4>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="fa fa-search" aria-hidden="true"></i></span>
                        </div>
                        <input type="text" class="form-control" onkeyup="BuscarEstudiante()" placeholder="Buscar estudiante por Ci, Nombre" id="TxtBuscarEstudiante">
                    </div>
                    <div id="ListarPersonaEstudiante" style="position: absolute; z-index: 10; width: 95%" class="list-group"></div>
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <input type="hidden" id="InsIdPersona" value="0" />
                            <label>DNI</label>
                            <input type="text" disabled class="form-control" placeholder="Dni" id="InsDNI" />
                            <label>Nombres</label>
                            <input type="text" disabled class="form-control" placeholder="Nombres" id="InsNombres" />
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <label>Apellido Paterno</label>
                            <input type="text" disabled class="form-control" placeholder="Apellido Paterno" id="InsApaterno" />
                            <label>Apellido Materno</label>
                            <input type="text" disabled class="form-control" placeholder="Apellido Materno" id="InsAmaterno" />
                        </div>
                    </div>
                    <label>Sexo</label>
                    <select id="InsSexo" disabled class="form-control mb-1">
                        <option value="M">Masculino</option>
                        <option value="F">Femenino</option>
                    </select>
                    <h4 class="form-section" style="margin-bottom:10px"><i class="fas fa-book"></i> Cursos</h4>
                    <div class="row">
                        <div class="col-lg-10 col-md-10 col-sm-10">
                            <div class="input-group" style="margin-bottom:5px">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fa fa-search" aria-hidden="true"></i></span>
                                </div>
                                <input type="text" class="form-control" id="TxtBuscarProgramaAcademico" placeholder="Buscar curso....">
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-2 col-sm-2">
                            <button type="button" onclick="BuscarProgramaAcademico(1,1)" style="margin-right:3px" class="btn mb-1 btn-block btn-outline-primary"><i class="fa fa-search"></i> </button>
                        </div>
                    </div>

                    <div class="row"style="margin-top:5px" id="CursosHtml">


                        <div class='col-xl-4 col-sm-6 col-lg-4 col-12'>
                            <div class='cardCarCustom card border-primary mb-0'>
                                <div class='card-body' style='padding:0px'>
                                    <h4 class='card-title' style='text-align:center;margin-bottom:4px; color:#007bff'>Azure Administrator Associate</h4>
                                </div>
                                <ul class='list-group list-group-flush'>
                                    <li class='list-group-item' style='padding:0.2rem;font-size:12px'>
                                        <span style='padding:3px;font-size:11px' class='badge badge-pill bg-blue float-right'>Diplomado</span><i class='far fa-bookmark'></i> Tipo Programa
                                    </li>
                                    <li class='list-group-item' style='padding:0.2rem;font-size:12px'>
                                        <span style='padding:3px;font-size:11px' class='badge badge-pill bg-blue float-right'>2020/06</span><i class='fas fa-layer-group'></i> Gestion
                                    </li>
                                    <li class='list-group-item' style='padding:0.2rem;font-size:12px'>
                                        <span style='padding:3px;font-size:11px' class='badge badge-pill bg-blue float-right'>V1</span><i class='fas fa-code-branch'></i> Version
                                    </li>
                                </ul>
                                <label class='text-center' style='margin:0px 0 0 0'>Objetivo</label>
                                <div class='alert alert-primary text-center' style='margin:0px 0 5px 0;padding:0 0 0 0'>Objetivo Diplomado</div>
                                <ul class='list-group list-group-flush'>
                                    <li class='list-group-item' style='padding:0.2rem;font-size:12px'>
                                        <span style='padding:3px;font-size:11px' class='badge badge-pill bg-blue float-right'>Semi-Presencial</span><i class='far fa-bookmark'></i> Modalidad
                                    </li>
                                </ul>
                                <hr style='margin:0px 0 2px 0'>
                                <tex class='form-control' style='border: 1px solid #FDFAFA;background-color: #FDFAFA; height: auto'>
                                    <h5 class='card-title ' style='text-align:center;margin-bottom:0px;'>Modulo I</h5>
                                    <div class='row'>
                                        <div class='col-6'>
                                            <label style='margin:0px 0 0 0'><i class='fa fa-users'></i> Grupo</label>
                                            <div class='alert alert-primary text-center' style='margin:0px 0 5px 0;padding:0 0 0 0'>Grupo I</div>
                                        </div>
                                        <div class='col-6'>
                                            <label style='margin:0px 0 0 0'><i class='fa fa-home'></i> Ambiente</label>
                                            <div class='alert alert-primary text-center' style='margin:0px 0 5px 0;padding:0 0 0 0'>B-23</div>
                                        </div>
                                    </div>
                                    <label class='text-center' style='margin:0px 0 0 0'><i class='fa fa-calendar-check'></i> Fechas, Dias, Hras</label>
                                    <div class='alert alert-primary text-center' style='margin:0px 0 5px 0;padding:0 0 0 0'>26/01/2021-30/01/2021</div>
                                    <div class='alert alert-primary text-center' style='margin:0px 0 5px 0;padding:0 0 0 0'>Lunes, Miercoles, Viernes</div>
                                    <div class='alert alert-primary text-center' style='margin:0px 0 5px 0;padding:0 0 0 0'>7:30am-8:30am</div>
                                    <label class='text-center' style='margin:0px 0 0 0'><i class='fa fa-user'></i> Docente</label>
                                    <div class='alert alert-warning text-center' style='margin:0px 0 5px 0;padding:0 0 0 0'>Pepe Rios Ortega</div>
                                </tex>
                                <ul class='list-group list-group-flush'>
                                    <li class='list-group-item' style='margin-top:2px;padding:0.2rem;font-size:12px'>
                                        <span style='padding:3px;font-size:11px' class='badge badge-pill bg-blue float-right'>18/02/2021</span><i class='far fa-calendar-check'></i> Fecha registro
                                    </li>
                                </ul>
                                <div style='margin-top:5px' class='footer'>
                                    <button type="button" id="BtnGuardar" class="btn btn-outline-primary btn-sm btn-block" onclick="Inscribir()"><i class="fa fa-user-plus"></i> Inscribir</button>
                                </div>
                            </div>
                        </div>


                    </div>                    
                    <div id="Inicio" style="width:100%;padding:8% 0 8% 0">
                        <h1 class="text-muted text-center"><i class="fa fa-frown-o"></i> SIN REGISTRO</h1>
                    </div>
                    <div class="text-center">
                        <ul class='pagination justify-content-end' id="PageCursos"></ul>
                    </div>
                    <hr style="margin-bottom:2px" />
                    <button type="button" class="btn btn-outline-danger btn-block" style="margin-bottom:10px" onclick="LimpiarCampos()"><i class="fas fa-broom"></i> Limpiar Campos</button>
                </div>
                <div class="col-lg-4 col-md-12 col-sm-12">
                    <h4 class="form-section" style="margin-bottom:0px"><i class="fas fa-bacon"></i> Cursando</h4>
                    <div class="containerCustom table-responsive">
                        <table class='table table-striped table-bordered dataTable table-sm' style='font-size:12px;' id="tcursando">
                            <thead>
                                <tr role="row">
                                    <th class="sorting" tabindex="0" aria-controls="tcursos" rowspan="1" colspan="1" aria-label="Cantidad: activate to sort column ascending">Programa</th>
                                    <th class="sorting" tabindex="0" aria-controls="tcursos" rowspan="1" colspan="1" aria-label="Cantidad: activate to sort column ascending">Estado</th>
                                    <th class="sorting" tabindex="0" aria-controls="tcursos" rowspan="1" colspan="1" aria-label="Valor: activate to sort column descending" style="width: 1px;" aria-sort="ascending"></th>
                                </tr>
                            </thead>
                            <tfoot>
                            </tfoot>
                        </table>
                    </div>
                    <h4 class="form-section" style="margin-bottom:10px"><i class="fas fa-tasks"></i> Cursado</h4>
                    <div class="containerCustom table-responsive">
                        <table class='table table-striped table-bordered dataTable table-sm' style='font-size:12px;' id="tcursado">
                            <thead>
                                <tr role="row">
                                    <th class="sorting" tabindex="0" aria-controls="tcursos" rowspan="1" colspan="1" aria-label="Cantidad: activate to sort column ascending">Programa</th>
                                    <th class="sorting" tabindex="0" aria-controls="tcursos" rowspan="1" colspan="1" aria-label="Cantidad: activate to sort column ascending">Estado</th>
                                    <th class="sorting" tabindex="0" aria-controls="tcursos" rowspan="1" colspan="1" aria-label="Valor: activate to sort column descending" style="width: 1px;" aria-sort="ascending"></th>
                                    <th class="sorting" tabindex="0" aria-controls="tcursos" rowspan="1" colspan="1" aria-label="Valor: activate to sort column descending" style="width: 1px;" aria-sort="ascending"></th>
                                </tr>
                            </thead>
                            <tfoot>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script type="text/javascript">
        $('#CursosHtml').hide();
        $('#Inicio').show();
        tablaCursando = $('#tcursando').DataTable({
            "bPaginate": false, "bFilter": false, info: false, language: { zeroRecords: "Sin Registros" }
        });
        tablaCursado = $('#tcursado').DataTable({
            "bPaginate": false, "bFilter": false, info: false, language: { zeroRecords: "Sin Registros" }
        });
        function BuscarProgramaAcademico(pageIndex, is) {
            $.getJSON('@Url.Action("BuscarPrgramaAcademico", "Inscripcion")', { SearchValue: $('#TxtBuscarProgramaAcademico').val(), PageIndex: pageIndex }, (O) => {
                if (O.Lst.length > 0) {
                    $('#CursosHtml').empty();
                    $('#CursosHtml').show();
                    $('#Inicio').hide();
                }
                var html = "";
                O.Lst.forEach((value, i) => {
                    html += "<div class='col-xl-4 col-sm-6 col-lg-4 col-12'><div class='cardCarCustom card border-primary mb-2'><div class='card-body' style='padding:0px'><h4 class='card-title' style='text-align:center;margin-bottom:4px; color:#007bff'>" + value.Programa + "</h4></div><ul class='list-group list-group-flush'><li class='list-group-item' style='padding:0.2rem;font-size:12px'><span style='padding:3px;font-size:11px' class='badge badge-pill bg-blue float-right'>" + value.TipoPA + "</span><i class='far fa-bookmark'></i> Tipo Programa</li><li class='list-group-item' style='padding:0.2rem;font-size:12px'><span style='padding:3px;font-size:11px' class='badge badge-pill bg-blue float-right'>" + value.Gestion + "</span><i class='fas fa-layer-group'></i> Gestion</li><li class='list-group-item' style='padding:0.2rem;font-size:12px'><span style='padding:3px;font-size:11px' class='badge badge-pill bg-blue float-right'>" + value.Version + "</span><i class='fas fa-code-branch'></i> Version</li></ul><label class='text-center' style='margin:0px 0 0 0'>Objetivo</label><div class='alert alert-primary text-center' style='margin:0px 0 5px 0;padding:0 0 0 0'>" + value.Objetivo + "</div><ul class='list-group list-group-flush'><li class='list-group-item' style='padding:0.2rem;font-size:12px'><span style='padding:3px;font-size:11px' class='badge badge-pill bg-blue float-right'>" + value.Modalidad + "</span><i class='far fa-bookmark'></i> Modalidad</li></ul><hr style='margin:0px 0 2px 0'><tex class='form-control' style='border: 1px solid #FDFAFA;background-color: #FDFAFA; height: auto'><h5 class='card-title ' style='text-align:center;margin-bottom:0px;'>" + value.Modulo + "</h5><div class='row'><div class='col-6'><label style='margin:0px 0 0 0'><i class='fa fa-users'></i> Grupo</label><div class='alert alert-primary text-center' style='margin:0px 0 5px 0;padding:0 0 0 0'>" + value.Grupo + "</div></div><div class='col-6'><label style='margin:0px 0 0 0'><i class='fa fa-home'></i> Ambiente</label><div class='alert alert-primary text-center' style='margin:0px 0 5px 0;padding:0 0 0 0'>" + value.Ambiente + "</div></div></div><label class='text-center' style='margin:0px 0 0 0'><i class='fa fa-calendar-check'></i> Fecha, Dias, Hora</label><div class='alert alert-primary text-center' style='margin:0px 0 5px 0;padding:0 0 0 0'>" + value.FechaCurso + "</div><div class='alert alert-primary text-center' style='margin:0px 0 5px 0;padding:0 0 0 0'>" + value.Dias + "</div><div class='alert alert-primary text-center' style='margin:0px 0 5px 0;padding:0 0 0 0'>" + value.Horario + "</div><label class='text-center' style='margin:0px 0 0 0'><i class='fa fa-user'></i> Docente</label><div class='alert alert-warning text-center' style='margin:0px 0 0px 0;padding:0 0 0 0'>" + value.Docente + "</div></tex><ul class='list-group list-group-flush'><li class='list-group-item' style='margin-top:0px;padding:0.2rem;font-size:12px'><span style='padding:3px;font-size:11px' class='badge badge-pill bg-blue float-right'>" + value.FechaDetalleCronograma + "</span><i class='far fa-calendar-check'></i> Fecha</li></ul><div style='margin-top:5px' class='footer'><button type='button' id='BtnGuardar' class='btn btn-outline-primary btn-sm btn-block' onclick='Inscribir(" + value.IdDetalleCronograma + ")'><i class='fa fa-user-plus'></i> Inscribir</button></div></div></div>";
                });
                $('#CursosHtml').html(html);

                var TotalPages = parseInt(O.TotalPages);
                var rangeMin = 4;
                var rangeMax = parseInt(TotalPages) == 1 ? 1 : rangeMin && parseInt(TotalPages) < rangeMin ? parseInt(TotalPages) : rangeMin;

                const paging = { range: rangeMax, pages: TotalPages };
                var PageArray = doPaging(pageIndex, paging);
                var sTatusPrev = (pageIndex <= 1) ? true : false;
                var sTatuslast = (pageIndex >= paging.pages) ? true : false;
                var html = "<li class='page-item first " + (sTatusPrev ? "disabled" : "") + "'><a href='#' class='page-link' onclick='BuscarProgramaAcademico(1, " + TotalPages + ")'>First</a></li><li class='page-item prev  " + (sTatusPrev ? "disabled" : "") + "'><a href='#' class='page-link' onclick='BuscarProgramaAcademico(" + parseInt(pageIndex - 1) + ", " + TotalPages + ")'>Prev</a></li>";
                PageArray.forEach((value, i) => {
                    html += value.Status
                        ?
                        "<li class='page-item active'><a class='page-link' href='#' onclick='BuscarProgramaAcademico(" + value.Page + ", " + TotalPages + ")'>" + value.Page + "</a></li>"
                        :
                        "<li class='page-item'><a class='page-link' href='#' onclick='BuscarProgramaAcademico(" + value.Page + ", " + TotalPages + ")'>" + value.Page + "</a></li>";
                });
                html += "<li class='page-item next " + (sTatuslast ? "disabled" : "") + "'><a href='#' class='page-link' onclick='BuscarProgramaAcademico(" + parseInt(pageIndex + 1) + ", " + TotalPages + ")'>Next</a></li><li class='page-item last " + (sTatuslast ? "disabled" : "") + "'><a href='#' class='page-link' onclick='BuscarProgramaAcademico(" + paging.pages + ", " + TotalPages + ")'>Last</a></li>";
                $('#PageCursos').html(html);
            });
        }
        function doPaging(current, { range, pages, start = 1 }) {
            const paging = [];
            var i = Math.min(pages + start - range, Math.max(start, current - (range / 2 | 0)));
            const end = i + range;
            while (i < end) {
                var infStatus = i === current ? true : false;
                paging.push({ Page: i++, Status: infStatus });
            };
            return paging;
        }
        function BuscarEstudiante() {
            $('#ListarPersonaEstudiante').html("");
            var Obj = { TxtParametro: $('#TxtBuscarEstudiante').val() };
            $.getJSON('@Url.Action("SearchEstudiante", "Inscripcion")', Obj, (O) => {
                if (O != null) {
                    O.forEach(value => {
                        $('#ListarPersonaEstudiante').append("<a style='text-decoration:none' onclick='SeleccionarPersonaEstudiante(" + value.Id + ",\"" + value.DNI + "\", \"" + value.Nombres + "\",\"" + value.Apaterno + "\",\"" + value.Amaterno + "\",\"" + value.Sexo + "\")' class='list-group-item' ><div style='display: inline-block'><i class='fa fa-user-o' style='margin-right: 5px'></i>" + value.Nombres + " " + value.Apaterno + " " + value.Amaterno + " " + value.DNI + "</div></a>");
                    });
                }
            });
        }
        function SeleccionarPersonaEstudiante(Id, DNI, Nombres, Apaterno, Amaterno, Sexo) {
            $('#IdDocente').val(Id);
            $('#TxtBuscarEstudiante').empty();
            $('#ListarPersonaEstudiante').empty();
            $('#InsIdPersona').val(Id);
            $('#InsDNI').val(DNI);
            $('#InsNombres').val(Nombres);
            $('#InsApaterno').val(Apaterno);
            $('#InsAmaterno').val(Amaterno);
            $('#InsSexo').val(Sexo);
            tablaCursando.clear().draw();
            tablaCursado.clear().draw();
            $.getJSON('@Url.Action("AllCursosInscritoEstudiante", "Inscripcion")', { IdEstudiante: Id }, (O) => {                
                if (O != null) {
                    for (var i = 0; i < O.length; i++) {
                        if (O[i].EstadoDetalleCronograma) {
                            fila1 = [O[i].Programa, "Cursando", "<button onclick='EliminarInscripcion(" + O[i].IdInscripcion + ")' style='float:right' class='btn btn-outline-danger btn-sm'><span class='fas fa-trash'></span></button>"];
                            tablaCursando.row.add(fila1).draw(false);
                        } else {
                            fila2 = [O[i].Programa, "Cursando", "<button onclick='EliminarInscripcion(" + O[i].IdInscripcion + ")' style='float:right' class='btn btn-outline-danger btn-sm'><span class='fas fa-trash'></span></button>"];
                            tablaCursado.row.add(fila2).draw(false);
                        }
                    }
                }
            });
        }
        function EliminarInscripcion(IdInscripcion) {
            $.getJSON('@Url.Action("EliminarInscripcion", "Inscripcion")', { IdInscripcion }, (O) => {                
                if (O.responce) {
                    LimpiarCampos();                    
                }
                MostarInfSave(O.StatusSave);
            });
        }
        function LimpiarCampos() {
            $('#IdDocente').val(0);
            $('#TxtBuscarEstudiante').val("");
            $('#ListarPersonaEstudiante').empty();
            $('#InsIdPersona').val(0);
            $('#InsDNI').val("");
            $('#InsNombres').val("");
            $('#InsApaterno').val("");
            $('#InsAmaterno').val("");
            $('#InsSexo').val("M");
            $('#TxtBuscarProgramaAcademico').val("");
            $('#PageCursos').hide();
            $('#CursosHtml').hide();
            $('#Inicio').show();
            tablaCursando.clear().draw();
            tablaCursado.clear().draw();
        }
        function Inscribir(IdDetalleCronograma) {
            var Obj = {
                DetalleCronograma: IdDetalleCronograma,
                Persona: $('#InsIdPersona').val()
            };
            $.getJSON('@Url.Action("Guardar", "Inscripcion")', Obj, (O) => {
                if (O.responce) {
                    LimpiarCampos();
                    //AllCronograma(1, 1);
                }
                MostarInfSave(O.StatusSave);
            });
        }
    </script>
}

